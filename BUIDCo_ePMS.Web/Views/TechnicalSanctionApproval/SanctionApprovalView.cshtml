@using Microsoft.Extensions.Configuration;
@inject IConfiguration Configuration
@{
    var pmLetterPath = Configuration.GetSection("Path").GetValue<string>("ProposalLetter");
    var pmencodedPath = Uri.EscapeDataString(pmLetterPath!);
    var taLetterPath = Configuration.GetSection("Path").GetValue<string>("TALetter");
    var taencodedPath = Uri.EscapeDataString(taLetterPath!);
    var aaLetterPath = Configuration.GetSection("Path").GetValue<string>("TSLetter");
    var aaencodedPath = Uri.EscapeDataString(aaLetterPath!);
    var tsLetterPath = Configuration.GetSection("Path").GetValue<string>("TSLetter");
    var tsencodedPath = Uri.EscapeDataString(tsLetterPath!);
    var tsotherdoc = Configuration.GetSection("Path").GetValue<string>("TSOtherDoc");
    var tsotherdocencodedPath = Uri.EscapeDataString(tsotherdoc!);
}
@Html.AntiForgeryToken()
<div class="page-body">
    <!-- breadcrumb section -->
    <div class="d-flex align-items-center justify-content-between mb-4 flex-wrap gap-3">
        <nav aria-label="breadcrumb">
            <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="#" title="Home"><i class="bi bi-house"></i></a></li>
                <li class="breadcrumb-item"><a href="#" title="Construction Steps"> Construction Steps </a></li>
                <li class="breadcrumb-item active" title="Technical Sanction Approval" aria-current="page"> Technical Sanction Approval </li>
            </ul>
        </nav>
        <div class="col-right">
            <button type="button" class="btn btn-primary btn-sm" title="Filter" data-bs-toggle="modal"
                    data-bs-target="#searchFilter">
                <i class="buidcoicon-filter"></i>
            </button>
            <button type="button" class="btn btn-outline-success btn-sm" title="Excel" data-bs-toggle="tooltip">
                <i class="buidcoicon-excel"></i>
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm" title="Print Preview"
                    data-bs-toggle="tooltip">
                <i class="bi bi-printer"></i>
            </button>
        </div>
    </div>
    <!-- breadcrumb section -->
    <!-- inner body section -->
    <div class="body__content">
        <div class="dashboard__tab">
            <div class="flex__tab">
                <div class="card card__bg flex-20">
                    <div class="card-body">
                        <div class="left__card">
                            <div class="icon__circle">
                                <i class="buidcoicon-application"></i>
                            </div>
                            <div class="card__text">
                                <p> Total Application </p>
                                <h4 id="htotalapplication" class="flex-1"> 0 </h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card flex-80 bg-transparent">
                    <div class="card-body p-0">
                        <div class="custom__pilltab" id="pill-navtab">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs nav-justified" role="tablist">
                                <li class="nav-item">
                                    <a id="a_NewApplication" class="nav-link active" role="tab"
                                       aria-selected="true">
                                        <div class="tab__icons">
                                            <div class="icon__circle bg-primary">
                                                <i class="buidcoicon-edit-document"></i>
                                            </div>
                                            <div class="tab__text">
                                                <p> New Application </p>
                                                <h4 id="hnewapplication" class="flex-1 text-primary"> 0 </h4>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="nav-item active">
                                    <a id="a_InProgress" class="nav-link" role="tab" aria-selected="false">
                                        <div class="tab__icons">
                                            <div class="icon__circle bg-warning">
                                                <i class="buidcoicon-in-progress"></i>
                                            </div>
                                            <div class="tab__text">
                                                <p> In-Progress </p>
                                                <h4 id="hinprogress" class="flex-1 text-warning"> 0 </h4>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a id="a_Approved" class="nav-link" role="tab" aria-controls="contact"
                                       aria-selected="false">
                                        <div class="tab__icons">
                                            <div class="icon__circle bg-success">
                                                <i class="buidcoicon-approved"></i>
                                            </div>
                                            <div class="tab__text">
                                                <p> Approved </p>
                                                <h4 id="happroved" class="flex-1 text-success"> 0 </h4>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a id="a_Cancelled" class="nav-link" role="tab"
                                       aria-selected="false">
                                        <div class="tab__icons">
                                            <div class="icon__circle bg-orange">
                                                <i class="buidcoicon-cancelled"></i>
                                            </div>
                                            <div class="tab__text">
                                                <p> Cancelled </p>
                                                <h4 id="hcancelled" class="flex-1 text-orange"> 0 </h4>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content">
            <div class="tab-pane fade" id="application" role="tabpanel">
                applciation view
            </div>
            <div class="tab-pane fade show active" id="NewApplication" role="tabpanel">
                <div class="body__bg">
                    <div id="dvfilterdata" class="card filter__datas">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3 justify-content-between flex-wrap">
                                <div class="item d-flex align-items-center column-gap-4 flex-wrap">
                                    <div class="mb-xl-0 mb-lg-0 mb-2 border-right">
                                        <label for="" class="m-0"> <span id="spsearchletterno" class="pe-xl-4 pe-lg-4 pe-md-4 description fw-600"> #1223452 </span>  </label>
                                    </div>
                                    <div class="mb-xl-0 mb-lg-0 mb-2 border-right">
                                        <label for="" class="m-0"> Financial Year :  <span id="spsearchfy" class="pe-xl-4 pe-lg-4 pe-md-4 description fw-600 ps-xl-2 ps-lg-2 ps-md-2"> 2025 </span>  </label>
                                    </div>
                                    <div class="mb-xl-0 mb-lg-0 mb-2">
                                        <label for="" class="m-0"> Proposal Submitted By :  <span id="spsearchclient" class="pe-xl-4 pe-lg-4 pe-md-4 description fw-600 ps-xl-2 ps-lg-2 ps-md-2"> Water Supply </span>  </label>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <span id="spsearchprojecttype" class="badge badge-warning"> Project Type </span>
                                </div>
                            </div>
                            <div class="d-flex align-items-center justify-content-between flex-wrap">
                                <div class="item d-flex align-items-center column-gap-4 flex-wrap">
                                    <div class="mb-xl-0 mb-lg-0 mb-2 border-right pe-xl-4 pe-lg-4">
                                        <label for="" class="m-0"> Category : </label>
                                        <span id="spsearchcategory" class=" ps-xl-2 ps-lg-2 fw-500">
                                            Water Supply Projects
                                        </span>
                                    </div>
                                    <div class="mb-xl-0 mb-lg-0 mb-2">
                                        <label for="" class="m-0"> Sub-Category : </label>
                                        <span id="spsearchsubcategory" class=" ps-xl-2 ps-lg-2 fw-500">
                                            Sub-Category 2
                                        </span>
                                    </div>
                                </div>
                                <div class="item d-flex align-items-center column-gap-4 flex-wrap">
                                    <div class="mb-xl-0 mb-lg-0 mb-2 border-right pe-xl-4 pe-lg-4">
                                        <label for="" class="m-0">  District : </label>
                                        <span id="spsearchdistrict" class=" ps-xl-2 ps-lg-2 fw-500">
                                            Khordha
                                        </span>
                                    </div>
                                    <div class="mb-xl-0 mb-lg-0 mb-2">
                                        <label for="" class="m-0">  Urban Local Body : </label>
                                        <span id="spsearchulb" class=" ps-xl-2 ps-lg-2 fw-500">
                                            NA
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="table__fixed">
                        <div class="border table-responsive">
                            <table class="table table-striped datatable" id="tblviewtsapproval">
                                <thead>
                                    <tr>
                                        <th style="width:50px"> Sl# </th>
                                        <th style="width:100px"> District </th>
                                        <th style="width:100px"> Scheme </th>
                                        <th class="mw-150"> Proposal <span class="d-block"> Submitted By </span> </th>
                                        <th class="mw-150">
                                            <div> Category </div>
                                            <small class="text-secondary"> Sub-Category </small>
                                        </th>
                                        <th class="mw-400"> Letter Details </th>
                                        <th class="mw-150"> Estimated <span class="d-block"> Cost </span> </th>
                                        <th class="mw-200"> Administartive <span class="d-block"> Approval </span> </th>
                                        <th class="mw-200"> Technical <span class="d-block"> Sanction Approval </span> </th>
                                        <th style="width:100px"> Status </th>
                                        <th style="width:80px"> Action </th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="approved" role="tabpanel">Approved</div>
            <div class="tab-pane fade" id="cancelled" role="tabpanel">Cancelled</div>
        </div>
    </div>
    <!-- inner body section -->

    <!-- search filter Modal -->
    <div class="modal fade right custom-view-modal-medium" id="searchFilter" tabindex="-1">
        <div class="modal-dialog modal-lg custom-modal modal-dialog-scrollable">
            @Html.Partial("~/Views/Home/_SearchFilter.cshtml")
        </div>
    </div>
    <!-- search filter Modal -->


    <!--  adminstrative list Modal -->

    <div class="modal fade right custom-view-modal-medium" id="uploadTech" tabindex="-1">
        <div class="modal-dialog modal-xl custom-modal modal-dialog-scrollable">
             @Html.Partial("_UploadSanctionApproval.cshtml")
        </div>
    </div>

    <!--  adminstrative list Modal -->

</div>
<!-- below script for view -->
<script src="~/js/forms/encryptdecrypt.js"></script>
<script>
    var baseUrl = "@Url.Content("~/")";
    $(document).ready(function () {

        $('#dvfilterdata').hide();
        $('#splayoutheader').text('Technical Sanction Approval');
        $.validator.addMethod("notEqualTo", function (value, element, param) {
            return this.optional(element) || value != param;
        }, "Please select an option");
        $.validator.addMethod("fileExtension", function (value, element, param) {
            param = typeof param === "string" ? param.replace(/,/g, "|") : "pdf";
            return this.optional(element) || value.match(new RegExp("\\.(" + param + ")$", "i"));
        }, "Only PDF files are allowed");
        $.validator.addMethod("fileSize", function (value, element, param) {
            // Check if the file size is less than param (in bytes)
            return this.optional(element) || (element.files[0] && element.files[0].size <= param);
        }, "File size must be less than 10MB");
        $("#formtsupload").validate({
            rules: {
                txttsLetterNo: { required: true },
                txttsLetterDate: { required: true, date: true },
                futsLetterPath: {
                    required: function () {
                        //return $('#hdnproposalid').val() == "0";
                        return true;
                    },
                    fileExtension: "pdf",
                    fileSize: 10 * 1024 * 1024
                },
                ddltsApprovedBy: { required: true, notEqualTo: "0" },
                ddlexecutionMode: { required: true, notEqualTo: "0" },
                boqPath: {
                    required: function () {
                        //return $('#hdnproposalid').val() == "0";
                        return true;
                    },
                    fileExtension: "pdf",
                    fileSize: 10 * 1024 * 1024
                },
                txtskilledLabour: { required: true },
                txtunskilledLabour: { required: true },
                txttsRemarks: { required: true, maxlength: 200 },
            },
            messages: {
                txttsLetterNo: { required: "Please enter TS Letter Number" },
                txttsLetterDate: { required: "Please enter TS Letter Date", date: "Please enter valid TS Letter Date" },
                futsLetterPath: {
                    required: "Please Upload Signed TS Letter",
                    fileExtension: "Only PDF files are allowed",
                    fileSize: "File size must be less than 10MB"
                },

                ddltsApprovedBy: { notEqualTo: "Please select TS Approved By" },
                ddlexecutionMode: { notEqualTo: "Please select Execution Mode" },
                boqPath: {
                    required: "Please Upload BQQ Document",
                    fileExtension: "Only PDF files are allowed",
                    fileSize: "File size must be less than 10MB"
                },
                txtskilledLabour: { required: "Please enter Skilled labour" },
                txtunskilledLabour: { required: "Please enter UnSkilled labour" },
                txttsRemarks: { required: "Please enter Remarks", maxlength: "Maximum 200 characters allowed" },
            },
            submitHandler: function (form) {
                // Form will submit if validation passes
                form.submit();
            },
            errorPlacement: function (error, element) {
                error.css("color", "red");
                error.insertAfter(element.closest(".form-group"));
            },
            highlight: function (element) {
                $(element).removeClass("is-valid");
                $(element).addClass("is-invalid");
                $(element).parent().addClass('error');
            },
            unhighlight: function (element) {
                $(element).removeClass("is-invalid");
                $(element).addClass("is-valid");
                $(element).parent().removeClass('error');
            }
        });
        $(".nav-link").click(function () {
            var tabelements = `
                <div class="body__bg">
                    <div id="dvfilterdata" class="card filter__datas">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3 justify-content-between flex-wrap">
                                <div class="item d-flex align-items-center column-gap-4 flex-wrap">
                                    <div class="mb-xl-0 mb-lg-0 mb-2 border-right">
                                        <label class="m-0"> <span id="spsearchletterno" class="pe-xl-4 pe-lg-4 pe-md-4 description fw-600"> #1223452 </span>  </label>
                                    </div>
                                    <div class="mb-xl-0 mb-lg-0 mb-2 border-right">
                                        <label class="m-0"> Financial Year :
                                            <span id="spsearchfy" class="pe-xl-4 pe-lg-4 pe-md-4 description fw-600 ps-xl-2 ps-lg-2 ps-md-2"> 2025 </span>
                                        </label>
                                    </div>
                                    <div class="mb-xl-0 mb-lg-0 mb-2">
                                        <label class="m-0"> Proposal Submitted By :
                                            <span id="spsearchclient" class="pe-xl-4 pe-lg-4 pe-md-4 description fw-600 ps-xl-2 ps-lg-2 ps-md-2"> Water Supply </span>
                                        </label>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <span id="spsearchprojecttype" class="badge badge-warning"> Project Type </span>
                                </div>
                            </div>
                            <div class="d-flex align-items-center justify-content-between flex-wrap">
                                <div class="item d-flex align-items-center column-gap-4 flex-wrap">
                                    <div class="mb-xl-0 mb-lg-0 mb-2 border-right pe-xl-4 pe-lg-4">
                                        <label class="m-0"> Category : </label>
                                        <span id="spsearchcategory" class=" ps-xl-2 ps-lg-2 fw-500">
                                            Water Supply Projects
                                        </span>
                                    </div>
                                    <div class="mb-xl-0 mb-lg-0 mb-2">
                                        <label class="m-0"> Sub-Category : </label>
                                        <span id="spsearchsubcategory" class=" ps-xl-2 ps-lg-2 fw-500">
                                            Sub-Category 2
                                        </span>
                                    </div>
                                </div>
                                <div class="item d-flex align-items-center column-gap-4 flex-wrap">
                                    <div class="mb-xl-0 mb-lg-0 mb-2 border-right pe-xl-4 pe-lg-4">
                                        <label class="m-0">  District : </label>
                                        <span id="spsearchdistrict" class=" ps-xl-2 ps-lg-2 fw-500">
                                            Khordha
                                        </span>
                                    </div>
                                    <div class="mb-xl-0 mb-lg-0 mb-2">
                                        <label class="m-0">  Urban Local Body : </label>
                                        <span id="spsearchulb" class=" ps-xl-2 ps-lg-2 fw-500">
                                            NA
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive">
                            <table class="table table-striped datatable" id="tblviewtsapproval">
                            <thead>
                                <tr>
                                    <th style="width:50px"> Sl# </th>
                                    <th style="width:120px"> District </th>
                                    <th style="width:360px"> Letter Details </th>
                                    <th style="width:200px">
                                        <div> Category </div>
                                        <small class="text-secondary"> Sub-Category </small>
                                    </th>
                                    <th style="width:190px"> Update Information </th>
                                    <th style="width:100px"> Status </th>
                                    <th style="width:150px"> Action </th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>`;
            $(".tab-pane").empty();
            //resetDatatable();
            // Remove active class from all tabs
            $(".nav-link").removeClass("active");
            $(".tab-pane").removeClass("show active");

            // Add active class to the clicked tab
            $(this).addClass("active");
            let tabId = $(this).attr("id").replace("a_", "");
            $("#" + tabId).html(tabelements);
            if ($('#hdnsearch').val() == 0) {
                $('#dvfilterdata').hide();
            }
            else {
                $('#dvfilterdata').show();
            }
            $("#" + tabId).addClass("show active");
            GetTSDetails(tabId);
        });
        GetTSDetails('NewApplication');
    });
    function lettersNumberValidate(event) {
        var keyCode = event.which || event.keyCode;
        // Allowed key codes: a-z, A-Z, 1-9, ., , , :, -, (, ), \, /
        var allowedKeyCodes = [...Array(10).keys()].map(i => i + 48) // 0-9
            .concat([...Array(26).keys()].map(i => i + 65)) // A-Z
            .concat([...Array(26).keys()].map(i => i + 97)) // a-z
            .concat([45]); // ., ,, :, -, (, ), \, / space
        // Check if the pressed key is allowed
        if (allowedKeyCodes.indexOf(keyCode) === -1) {
            event.preventDefault();
        }
    }
    function lettersDigitValidate(event) {
        var keyCode = event.which || event.keyCode;
        // Allowed key codes: a-z, A-Z, 1-9, ., , , :, -, (, ), \, /
        var allowedKeyCodes = [...Array(10).keys()].map(i => i + 48) // 0-9
            .concat([...Array(26).keys()].map(i => i + 65)) // A-Z
            .concat([...Array(26).keys()].map(i => i + 97)) // a-z
            .concat([32]); // ., ,, :, -, (, ), \, / space
        // Check if the pressed key is allowed
        if (allowedKeyCodes.indexOf(keyCode) === -1) {
            event.preventDefault();
        }
    }
    function updateCharCount(textArea) {
        var maxLength = $(textArea).attr("maxlength"); // Get maxlength from textarea
        var currentLength = $(textArea).val().length; // Current text length
        var remaining = maxLength - currentLength; // Remaining characters

        var spanId = $(textArea).data("targetid"); // Get target span ID from data attribute
        $('#' + spanId).text(remaining); // Update the count in the span

        if (remaining < 0) {
            alert("You have reached your maximum limit of characters allowed.");
            $(textArea).val($(textArea).val().substring(0, maxLength)); // Trim input
            $('#' + spanId).text(0); // Set to 0 when limit is exceeded
        }
    }
    $(document).on('blur keyup', '.LengthRemarks', function () {
        updateCharCount(this);
    });
    function formatDate(inputDate) {
        const date = new Date(inputDate); // Convert input to Date object

        const day = date.getDate().toString().padStart(2, '0'); // Get day with leading zero
        const monthAbbr = date.toLocaleString('en-US', { month: 'short' }); // Get short month name
        const year = date.getFullYear();

        return `${day}-${monthAbbr}-${year}`;
    }
    function GetTSDetails(searchtype) {
        debugger
        resetDatatable();
        $.ajax({
            type: 'Get',
            dataType: 'Json',
            contentType: 'application/json; charset=utf-8',
            data: { "searchtype": searchtype },
            url: "@Url.Action("GetTSDetails", "TechnicalSanctionApproval")",
            success: function (result) {
                var data = JSON.parse(result);
                var data1 = JSON.parse(data.data);
                console.log(data1);
                debugger
                $('#htotalapplication').text(data1.tssummary.TotalApplication);
                $('#hnewapplication').text(data1.tssummary.NewApplication);
                $('#hinprogress').text(data1.tssummary.InProgress);
                $('#happroved').text(data1.tssummary.Approved);
                $('#hcancelled').text(data1.tssummary.Cancelled);
                $('#tblviewtsapproval tbody').empty();
                if (data1.tsapproval) {
                    $.each(data1.tsapproval, function (i, data) {
                        //var encryptedurl = '@Url.Action("SanctionApprovalDetails", "TechnicalSanctionApproval")' + '?Id=' + encryptData(data.proposalid);
                        //var url = '@Url.Action("DownloadFiles", "Proposal")' + '?filename=' + data.aaLetterPath + '&filepath=@pmencodedPath';
                        var trows = "<tr>";
                        trows += "<td>" + (i + 1) + "</td>";
                        trows += "<td>" + data.district + "</td>";
                        trows += "<td>" + data.scheme + "</td>";
                        trows += "<td>Department</td>";
                        trows += `<td>
                        <label for="" class="fw-600"> `+ data.categoryName + ` </label>
                        <p class="text-secondary">`+ data.subCategoryName + `</p>
                          </td>`;
                                    trows += `<td>
                            <div class="table__body__text">
                                <div class="row mb-3">
                                    <div class="col-xl-8 col-12 d-flex align-items-center column-gap-4 mb-2 flex-wrap">
                                        <div class="badge bg-yellow fw-600">
                                                    <span class="text-solid-black"> `+ data.proposalLetterNo + ` </span>
                                        </div>
                                                    <div class="text-secondary"><i class="text-light-primary buidcoicon-calendar-day me-2"></i> ` + formatDate(data.proposalLetterDate) + ` </div>
                                    </div>
                                    <div class="col-xl-4 col-12 text-start text-xl-end">
                                            <a href="`+ baseUrl + `Proposal/DownloadFiles?filename=` + data.proposalletterPath + `&filepath=@pmencodedPath" data-bs-toggle="tooltip" class="text-secondary" title="Download Letter">
                                            <i class="bi bi-file-earmark-pdf me-1 text-danger"></i> Download
                                        </a>
                                    </div>
                                </div>
                                <div class="content">
                                            <p>` + data.proposalSubject + `</p>
                                </div>
                            </div>
                          </td>`;
                        trows += "<td>" + data.taestimatedCost + "</td>";
                        trows += `<td class="fs-7">
                            <div class="mb-2"><span class="text-secondary pe-2">Approved By:</span><strong>AE</strong></div>
                                    <div class="mb-2"><i class="text-light-primary buidcoicon-calendar-day me-2"></i>` + formatDate(data.aaLetterDate) + `</div>
                                    <a href="`+ baseUrl + `Proposal/DownloadFiles?filename=` + data.aaLetterPath + `&filepath=@aaencodedPath" data-bs-toggle="tooltip" title="Download Letter">
                                <i class="bi bi-file-earmark-pdf me-1 text-danger"></i>Download
                            </a>
                          </td>`;
                        if (data.status == 'Pending Generate') {
                            trows += `<td><a href=@Url.Action("GenerateLetter", "Home") class="btn btn-outline-success btn-sm" title="Upload"><i class="buidcoicon-file me-2"></i> Generate</a></td>`;
                        }
                        else if (data.status == 'Pending Upload') {
                            trows += `<td>
                                        <div class="row">

                                            <div class="border-end  mb-3 col-xxl-8 col-xl-9 col-lg-9 col-md-9 col-9">
                                                <small class="text-secondary"> Generated On </small>
                                                        <p class="m-0"> ` + formatDate(data.tsLetterGendate) + ` </p>
                                            </div>

                                                    <a href="`+ baseUrl + `Proposal/DownloadFiles?filename=` + data.tsLetterPath + `&filepath=@tsencodedPath" class="text-danger col-xxl-4 col-xl-3 col-lg-3 col-md-3 col-3" data-bs-toggle="tooltip" title="View Document">
                                                <i class="bi bi-file-earmark-pdf" title="Download PDF"> </i>
                                            </a>

                                        </div>

                                                                        <button type="button" onclick="GetTSApprovalByID(`+ data.proposalId + `)" class="btn btn-outline-primary btn-sm" title="Upload">
                                                    <i class="bi bi-cloud-upload me-2"></i> Upload
                                                </button>
                                </td>`;
                        }
                        else if (data.status == 'Pending Submission') {
                            trows += `<td>
                                <div class="row">

                                                <div class="border-end  mb-3 col-xxl-8 col-xl-9 col-lg-9 col-md-9 col-9">
                                                    <small class="text-secondary"> Generated On </small>
                                                            <p class="m-0"> ` + formatDate(data.tsLetterGendate) + ` </p>
                                                </div>

                                                        <a href="`+ baseUrl + `Proposal/DownloadFiles?filename=` + data.tsLetterPath + `&filepath=@tsencodedPath" class="text-danger col-xxl-4 col-xl-3 col-lg-3 col-md-3 col-3" data-bs-toggle="tooltip" title="View Document">
                                                    <i class="bi bi-file-earmark-pdf" title="Download PDF"> </i>
                                                </a>

                                            </div>
                            <div class="row">
                                <div class="border-end mb-3 col-xxl-8 col-xl-9 col-lg-9 col-md-9 col-9">
                                    <small class="text-secondary">Approved On</small>
                                    <p class="m-0">26-Jun-2025</p>
                                </div>
                                <a href="#" class="text-danger col-xxl-4 col-xl-3 col-lg-3 col-md-3 col-3" data-bs-toggle="tooltip" title="View Location">
                                    <img src="~/images/svg/google-map.svg" alt="Google Map">
                                </a>
                            </div>
                          </td>`;
                        }
                        trows += `<td><span class="badge badge-warning"> ` + data.status + ` </span></td>`;
                        trows += `<td>
                <div class="table__icon">
                    <a href="~/TechnicalSanctionApproval/SanctionApprovalDetails" title="View" data-bs-toggle="tooltip">
                        <i class="buidcoicon-eye text-success"></i>
                    </a>
                                <a onclick="GetTSApprovalByID(` + data.proposalId + `)" class="text-primary" href="#!" title="Edit" data-bs-toggle="tooltip">
                        <i class="buidcoicon-edit"></i>
                    </a>
                    <a href="#!" title="Delete" data-bs-toggle="tooltip">
                        <i class="buidcoicon-trash text-orange"></i>
                    </a>
                </div>
              </td>`;
                        trows += "</tr>";

                        // Append row to table body
                        $("#tblviewtsapproval tbody").append(trows);
                    });

                    bindDatatable();
                }
                else {
                    //bindDatatable();
                }
            },
            error: function (Message) {
                alert(Message);
            }
        });
    }
    function GetTSApprovalByID(proposalid) {
        $.ajax({
            type: 'Get',
            dataType: 'Json',
            contentType: 'application/json; charset=utf-8',
            data: { Id: proposalid },
            url: baseUrl + "TechnicalSanctionApproval/GetTSApprovalByID",
            success: function (result) {
                debugger
                var data = JSON.parse(result);
                var data1 = JSON.parse(data.data);
                console.log('TSapproval data');
                console.log(data1);
                $('#taEstimatedCost').text(data1.taEstimatedCost);
                $('#aaEstimatedCost').text(data1.aaEstimatedCost);
                $('#a_taLetterPath').attr("href", baseUrl + 'Proposal/DownloadFiles?filename=' + data1.taLetterPath + '&filepath=@taencodedPath');
                $('#a_aaLetterPath').attr("href", baseUrl + 'Proposal/DownloadFiles?filename=' + data1.aaLetterPath + '&filepath=@aaencodedPath');
                $('#hdntsId').val(data1.tsId);
                $('#hdntaproposalId').val(data1.proposalId);
                $('#txttsLetterNo').val(data1.tsLetterNo);
                var minDate = new Date("1900-01-01");
                var tsdate = new Date(data1.tsLetterDate);
                alert(minDate);
                alert(tsdate);
                if (tsdate > minDate) { 
                    alert(tsdate);
                    $('#txttsLetterDate').val(formatDate(data1.tsLetterDate));
                }
                if (data1.tsLetterPath != null) { 
                    $('#atsLetterPath').attr("href", baseUrl + 'Proposal/DownloadFiles?filename=' + data1.tsLetterPath + '&filepath=@tsencodedPath');
                    $('#atsLetterPath').show();
                }
                if (data1.executionMode != null) {
                    $('#ddlexecutionMode').val(data1.executionMode);
                }
                $('#aboqPath').attr("href", baseUrl + 'Proposal/DownloadFiles?filename=' + data1.boqPath + '&filepath=@tsotherdocencodedPath');

                $('#aboqPath').show();
                if (data1.skilledLabour!=0)
                    $('#txtskilledLabour').val(data1.skilledLabour);
                if (data1.unskilledLabour != 0)
                    $('#txtunskilledLabour').val(data1.unskilledLabour);
                $('#txttsRemarks').val(data1.tsRemarks);
                $("#formtsupload").validate().resetForm();
                $("#formtsupload").find(".is-valid, .is-invalid").removeClass("is-valid is-invalid");
                $("#formtsupload").find(".error").removeClass("error");
            },
            error: function (Message) {
                alert(Message);
            }
        });
        $('#uploadTech').modal('show');
    }
    function UploadTSInformation() {
        if ($("#formtsupload").valid()) {
            var formData = new FormData();
            formData.append("tsId", $('#hdntsId').val());
            formData.append("proposalId", $('#hdntaproposalId').val());
            //formData.append("tsLetterGendate", $.trim($("#ddlclient").val()));
            formData.append("tsLetterNo", $.trim($("#txttsLetterNo").val()));
            formData.append("tsLetterDate", $.trim($("#txttsLetterDate").val()));
            formData.append("executionMode", $.trim($("#ddlexecutionMode").val()));
            formData.append("skilledLabour", $.trim($("#txtskilledLabour").val()));
            formData.append("unskilledLabour", $.trim($("#txtunskilledLabour").val()));
            formData.append("tsRemarks", $.trim($("#txttsRemarks").val()));
            var signedTSLetterFile = $('#futsLetterPath')[0].files[0];
            if (signedTSLetterFile) {
                formData.append("signedTSLetterFile", signedTSLetterFile);
            }
            var boqFile = $('#boqPath')[0].files[0];
            if (boqFile) {
                formData.append("boqFile", boqFile);
            }
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, Update it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: "POST",
                        url: baseUrl + "TechnicalSanctionApproval/UploadTSInformation",
                        beforeSend: function (xhr) {
                            xhr.setRequestHeader("XSRF-TOKEN", $('input:hidden[name="__RequestVerificationToken"]').val());
                        },
                        data: formData,
                        processData: false, // **Important for FormData**
                        contentType: false, // **Important for FormData**
                        success: function (result) {
                            Swal.fire({
                                icon: result.sucess ? 'success' : 'error',
                                title: result.responseText,
                                text: result.responseMessage,
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    location.href = baseUrl + "TechnicalSanctionApproval/SanctionApprovalView";
                                }
                            })
                        },
                        error: function (result) {
                            Swal.fire({
                                icon: 'error',
                                title: result.responseText,
                                text: result.responseMessage,
                            });
                        }
                    });
                }
            });
        }
    }
    function ResetTSUpload() { 
    }
</script>
<!-- below script for upload ts approval -->
<!-- below script for filter search -->
<script src="~/js/forms/searchproposal.js"></script>